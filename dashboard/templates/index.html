<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0f172a" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
    <title>Market Strategy Testing Bot - Dashboard</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Professional trading bot dashboard for cryptocurrency and prediction markets">
    <meta name="application-name" content="Market Strategy Bot">
    
    <!-- Apple iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Market Bot">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/static/icons/icon-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/icons/icon-180x180.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/icons/icon-152x152.png">
    
    <!-- Device Detector (must load first) -->
    <script src="/static/js/device-detector.js"></script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Chart.js Zoom Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.0/dist/chartjs-plugin-zoom.min.js"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Core CSS -->
    <link rel="stylesheet" href="/static/css/charts-fixed.css">
    <link rel="stylesheet" href="/static/css/crypto_ticker.css">
    
    <!-- New UX Feature CSS -->
    <link rel="stylesheet" href="/static/css/mobile.css">
    <link rel="stylesheet" href="/static/css/mobile-dark.css">
    <link rel="stylesheet" href="/static/css/skeletons.css">
    
    <!-- Custom Tailwind Config -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'profit': '#10b981',
                        'loss': '#ef4444',
                        'dark-bg': '#0f172a',
                        'dark-card': '#1e293b',
                        'dark-border': '#334155'
                    }
                }
            }
        }
    </script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        .card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }
        
        .card.clickable {
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        .card.clickable:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 28px rgba(29, 161, 242, 0.3);
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .profit-gradient {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .loss-gradient {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            transition: all 0.3s;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 20px rgba(59, 130, 246, 0.3);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
    
    <!-- Service Worker Registration -->
    <script>
        // Register service worker for PWA support
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('Service Worker registered successfully:', registration.scope);
                    })
                    .catch(error => {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</head>
<body class="bg-dark-bg text-gray-100">
    
    <!-- Mobile Top Bar -->
    <div class="mobile-top-bar">
        <div class="mobile-top-bar-left">
            <button class="hamburger-menu" aria-label="Open menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
        <div class="mobile-top-bar-center">
            <div class="mobile-logo">ðŸ“Š Market Bot</div>
        </div>
        <div class="mobile-top-bar-right">
            <span id="connection-status" class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-900/20 text-green-400">
                <span class="w-2 h-2 bg-green-400 rounded-full mr-1"></span>
                <span id="connection-status-text">Connected</span>
            </span>
        </div>
    </div>
    
    <!-- Mobile Slide-out Menu (trading-first IA) -->
    <div class="mobile-menu-overlay">
        <nav>
            <span class="text-xs text-gray-500 uppercase tracking-wider px-3 py-2 block">Main</span>
            <a href="#" onclick="showPage('overview', event)" class="active" data-page="overview">
                <i class="fas fa-home mr-2"></i> Overview
            </a>
            <a href="#" onclick="showPage('strategies', event)" data-page="strategies">
                <i class="fas fa-chess mr-2"></i> Strategies
            </a>
            <a href="#" onclick="showPage('markets', event)" data-page="markets">
                <i class="fas fa-chart-line mr-2"></i> Markets &amp; Charts
            </a>
            <a href="#" onclick="showPage('execution', event)" data-page="execution">
                <i class="fas fa-play-circle mr-2"></i> Execution
            </a>
            <a href="#" onclick="showPage('results', event)" data-page="results">
                <i class="fas fa-trophy mr-2"></i> Results &amp; Analysis
            </a>
            <a href="#" onclick="showPage('system', event)" data-page="system">
                <i class="fas fa-server mr-2"></i> System Status
            </a>
            <span class="text-xs text-gray-500 uppercase tracking-wider px-3 py-2 block mt-2">More</span>
            <a href="#" onclick="showPage('trades', event)" data-page="trades">
                <i class="fas fa-exchange-alt mr-2"></i> Trades
            </a>
            <a href="#" onclick="showPage('opportunities', event)" data-page="opportunities">
                <i class="fas fa-lightbulb mr-2"></i> Opportunities
            </a>
            <a href="#" onclick="showPage('analytics', event)" data-page="analytics">
                <i class="fas fa-chart-bar mr-2"></i> Analytics
            </a>
            <a href="#" onclick="showPage('control', event)" data-page="control">
                <i class="fas fa-gamepad mr-2"></i> Control
            </a>
            <a href="#" onclick="showPage('tax', event)" data-page="tax">
                <i class="fas fa-file-invoice-dollar mr-2"></i> Tax Reports
            </a>
            <a href="#" onclick="showPage('settings', event)" data-page="settings">
                <i class="fas fa-cog mr-2"></i> Settings
            </a>
        </nav>
    </div>
    
    <!-- Mobile Menu Backdrop -->
    <div class="mobile-menu-backdrop"></div>
    
    <!-- Mobile Bottom Navigation (trading-first: monitor, strategies, execution, results) -->
    <nav class="bottom-nav">
        <button class="bottom-nav-item active" onclick="showPage('overview', event)" data-page="overview">
            <i class="fas fa-home"></i>
            <span>Overview</span>
        </button>
        <button class="bottom-nav-item" onclick="showPage('strategies', event)" data-page="strategies">
            <i class="fas fa-chess"></i>
            <span>Strategies</span>
        </button>
        <button class="bottom-nav-item" onclick="showPage('execution', event)" data-page="execution">
            <i class="fas fa-play-circle"></i>
            <span>Execution</span>
        </button>
        <button class="bottom-nav-item" onclick="showPage('results', event)" data-page="results">
            <i class="fas fa-trophy"></i>
            <span>Results</span>
        </button>
        <button class="bottom-nav-item" onclick="toggleMobileMenu(event)">
            <i class="fas fa-bars"></i>
            <span>More</span>
        </button>
    </nav>
    
    <!-- Navigation -->
    <nav class="bg-dark-card border-b border-dark-border sticky top-0 z-50 desktop-nav">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center space-x-2">
                    <h1 class="text-2xl font-bold tracking-tight">ðŸ“Š Market Strategy Bot</h1>
                </div>
                
                <div class="flex items-center space-x-4 flex-wrap">
                    <button onclick="showPage('overview', event)" class="nav-link text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition" data-page="overview">
                        <i class="fas fa-home mr-2"></i>Overview
                    </button>
                    <button onclick="showPage('strategies', event)" class="nav-link text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition" data-page="strategies">
                        <i class="fas fa-chess mr-2"></i>Strategies
                    </button>
                    <button onclick="showPage('markets', event)" class="nav-link text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition" data-page="markets">
                        <i class="fas fa-chart-line mr-2"></i>Markets
                    </button>
                    <button onclick="showPage('execution', event)" class="nav-link text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition" data-page="execution">
                        <i class="fas fa-play-circle mr-2"></i>Execution
                    </button>
                    <button onclick="showPage('results', event)" class="nav-link text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition" data-page="results">
                        <i class="fas fa-trophy mr-2"></i>Results
                    </button>
                    <button onclick="showPage('system', event)" class="nav-link text-gray-300 hover:text-white px-3 py-2 rounded-md text-sm font-medium transition" data-page="system">
                        <i class="fas fa-server mr-2"></i>System
                    </button>
                    <span class="text-gray-600">|</span>
                    <button onclick="showPage('trades', event)" class="nav-link text-gray-400 hover:text-white px-2 py-2 rounded-md text-xs font-medium transition" data-page="trades">Trades</button>
                    <button onclick="showPage('opportunities', event)" class="nav-link text-gray-400 hover:text-white px-2 py-2 rounded-md text-xs font-medium transition" data-page="opportunities">Opportunities</button>
                    <button onclick="showPage('analytics', event)" class="nav-link text-gray-400 hover:text-white px-2 py-2 rounded-md text-xs font-medium transition" data-page="analytics">Analytics</button>
                    <button onclick="showPage('tax', event)" class="nav-link text-gray-400 hover:text-white px-2 py-2 rounded-md text-xs font-medium transition" data-page="tax">Tax</button>
                    <button onclick="showPage('settings', event)" class="nav-link text-gray-400 hover:text-white px-2 py-2 rounded-md text-xs font-medium transition" data-page="settings">Settings</button>
                    <button onclick="showPage('control', event)" class="nav-link text-gray-400 hover:text-white px-2 py-2 rounded-md text-xs font-medium transition" data-page="control">Control</button>
                    
                    <!-- Manual Refresh Button -->
                    <button id="manual-refresh-btn" class="px-3 py-2 rounded-md text-sm font-medium bg-blue-600 hover:bg-blue-700 transition" title="Refresh data">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    
                    <!-- Combined Status Indicator -->
                    <div id="combined-status" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-900/20 text-green-400">
                        <span class="relative flex h-3 w-3 mr-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75" id="status-ping"></span>
                            <span class="relative inline-flex rounded-full h-3 w-3 bg-green-500" id="status-dot"></span>
                        </span>
                        <span id="combined-status-text">Bot Running â€¢ Connected</span>
                    </div>
                    
                    <!-- Data Source Indicator -->
                    <div id="data-source-indicator" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-900/20 text-blue-400">
                        <i class="fas fa-database mr-2"></i>
                        <span id="data-source-text">ðŸ“Š Historical Data</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Crypto Ticker -->
    <div class="crypto-ticker sticky top-16 z-40">
        <div class="crypto-ticker-container">
            <div class="ticker-items">
                <!-- BTC -->
                <a href="https://www.tradingview.com/chart/?symbol=BTCUSD" target="_blank" rel="noopener noreferrer" class="ticker-item ticker-link" data-tooltip="Bitcoin - Click to view chart">
                    <div class="ticker-symbol">BTC</div>
                    <div class="ticker-data">
                        <div id="ticker-price-BTC" class="ticker-price">$0.00</div>
                        <div id="ticker-change-BTC" class="ticker-change text-gray-500">0.00%</div>
                    </div>
                </a>
                
                <!-- ETH -->
                <a href="https://www.tradingview.com/chart/?symbol=ETHUSD" target="_blank" rel="noopener noreferrer" class="ticker-item ticker-link" data-tooltip="Ethereum - Click to view chart">
                    <div class="ticker-symbol">ETH</div>
                    <div class="ticker-data">
                        <div id="ticker-price-ETH" class="ticker-price">$0.00</div>
                        <div id="ticker-change-ETH" class="ticker-change text-gray-500">0.00%</div>
                    </div>
                </a>
                
                <!-- SOL -->
                <a href="https://www.tradingview.com/chart/?symbol=SOLUSD" target="_blank" rel="noopener noreferrer" class="ticker-item ticker-link" data-tooltip="Solana - Click to view chart">
                    <div class="ticker-symbol">SOL</div>
                    <div class="ticker-data">
                        <div id="ticker-price-SOL" class="ticker-price">$0.00</div>
                        <div id="ticker-change-SOL" class="ticker-change text-gray-500">0.00%</div>
                    </div>
                </a>
                
                <!-- XRP -->
                <a href="https://www.tradingview.com/chart/?symbol=XRPUSD" target="_blank" rel="noopener noreferrer" class="ticker-item ticker-link" data-tooltip="Ripple - Click to view chart">
                    <div class="ticker-symbol">XRP</div>
                    <div class="ticker-data">
                        <div id="ticker-price-XRP" class="ticker-price">$0.00</div>
                        <div id="ticker-change-XRP" class="ticker-change text-gray-500">0.00%</div>
                    </div>
                </a>
            </div>
            
            <div class="ticker-info">
                <div class="ticker-timestamp">
                    <i class="fas fa-clock"></i>
                    <span id="ticker-timestamp">Loading...</span>
                </div>
                <div id="ticker-stale-warning" class="ticker-stale-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>Stale data</span>
                </div>
            </div>
        </div>
        <div id="ticker-error" class="ticker-error"></div>
    </div>
    
    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Overview Page -->
        <div id="page-overview" class="page-content">
            <div class="mb-8 flex justify-between items-center">
                <div>
                    <h2 class="text-3xl font-bold mb-2">Dashboard Overview</h2>
                    <p class="text-gray-400">Real-time performance metrics and analytics</p>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- Data Health Indicator -->
                    <div class="data-health-indicator">
                        <span id="health-status" class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-900/20 text-green-400 cursor-pointer" onclick="verifyDataQuality()" title="Click to verify data quality">
                            <span class="status-icon mr-2">ðŸŸ¢</span>
                            <span class="status-text">Data Healthy</span>
                        </span>
                        <button id="verify-data-btn" onclick="verifyDataQuality()" class="ml-2 px-3 py-1 text-xs rounded bg-blue-600 hover:bg-blue-700 transition">
                            Verify Data
                        </button>
                    </div>
                    <label class="flex items-center cursor-pointer">
                        <span class="text-sm text-gray-400 mr-2">Auto-refresh (<span id="refresh-interval-display">5s</span>)</span>
                        <input type="checkbox" id="auto-refresh-toggle" class="sr-only peer" checked>
                        <div class="relative w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                    </label>
                </div>
            </div>
            
            <!-- Key Metrics Cards (Clickable) -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <!-- Total P&L Card -->
                <div class="card clickable bg-dark-card rounded-xl p-6 border border-dark-border" onclick="navigateTo('/analytics?view=pnl-breakdown')" title="Click to see P&L breakdown">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-400 text-sm">Total P&L</span>
                        <i class="fas fa-dollar-sign text-blue-500"></i>
                    </div>
                    <div class="text-3xl font-bold mb-1" id="total-pnl">$0.00</div>
                    <div class="flex items-center text-sm">
                        <span id="pnl-change" class="text-profit">+0%</span>
                        <span class="text-gray-500 ml-2">vs yesterday</span>
                    </div>
                </div>
                
                <!-- Win Rate Card -->
                <div class="card clickable bg-dark-card rounded-xl p-6 border border-dark-border" onclick="navigateTo('/analytics?view=win-loss-breakdown')" title="Click to see win/loss breakdown">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-400 text-sm">Win Rate</span>
                        <i class="fas fa-percentage text-green-500"></i>
                    </div>
                    <div class="text-3xl font-bold mb-1" id="win-rate">0%</div>
                    <div class="w-full bg-gray-700 rounded-full h-2 mt-2">
                        <div id="win-rate-bar" class="bg-profit h-2 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
                
                <!-- Active Trades Card -->
                <div class="card clickable bg-dark-card rounded-xl p-6 border border-dark-border" onclick="navigateTo('/trades?status=open')" title="Click to see active trades">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-400 text-sm">Active Trades</span>
                        <i class="fas fa-chart-line text-yellow-500"></i>
                    </div>
                    <div class="text-3xl font-bold mb-1" id="active-trades">0</div>
                    <div class="text-sm text-gray-500">Currently open</div>
                </div>
                
                <!-- Total Trades Card -->
                <div class="card clickable bg-dark-card rounded-xl p-6 border border-dark-border" onclick="navigateTo('/trades')" title="Click to see all trades">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-gray-400 text-sm">Total Trades</span>
                        <i class="fas fa-list text-purple-500"></i>
                    </div>
                    <div class="text-3xl font-bold mb-1" id="total-trades">0</div>
                    <div class="text-sm text-gray-500">All time</div>
                </div>
            </div>
            
            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <!-- Cumulative P&L Chart -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Cumulative P&L</h3>
                        <div class="flex space-x-2">
                            <button onclick="updateCumulativePNL('1W', event)" class="px-3 py-1 text-xs rounded bg-gray-700 hover:bg-gray-600">1W</button>
                            <button onclick="updateCumulativePNL('1M', event)" class="px-3 py-1 text-xs rounded bg-blue-600">1M</button>
                            <button onclick="updateCumulativePNL('3M', event)" class="px-3 py-1 text-xs rounded bg-gray-700 hover:bg-gray-600">3M</button>
                            <button onclick="updateCumulativePNL('ALL', event)" class="px-3 py-1 text-xs rounded bg-gray-700 hover:bg-gray-600">ALL</button>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="cumulative-pnl-chart"></canvas>
                    </div>
                </div>
                
                <!-- Daily P&L Chart -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h3 class="text-lg font-semibold mb-4">Daily P&L</h3>
                    <div class="chart-container">
                        <canvas id="daily-pnl-chart"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Strategy Performance & Recent Activity -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Strategy Performance -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h3 class="text-lg font-semibold mb-4">Strategy Performance</h3>
                    <div class="chart-container">
                        <canvas id="strategy-performance-chart"></canvas>
                    </div>
                </div>
                
                <!-- Recent Activity Feed -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold">Recent Activity</h3>
                        <button id="pause-activity" onclick="toggleActivityPause()" class="px-3 py-1 text-xs rounded bg-gray-700 hover:bg-gray-600 transition">
                            <i class="fas fa-pause"></i> Pause
                        </button>
                    </div>
                    
                    <!-- Activity Filters -->
                    <div class="flex space-x-2 mb-4">
                        <button class="filter-btn active px-3 py-1 text-xs rounded bg-blue-600" data-filter="all" onclick="filterActivity('all', event)">All</button>
                        <button class="filter-btn px-3 py-1 text-xs rounded bg-gray-700 hover:bg-gray-600" data-filter="trades" onclick="filterActivity('trades', event)">Trades</button>
                        <button class="filter-btn px-3 py-1 text-xs rounded bg-gray-700 hover:bg-gray-600" data-filter="opportunities" onclick="filterActivity('opportunities', event)">Opportunities</button>
                        <button class="filter-btn px-3 py-1 text-xs rounded bg-gray-700 hover:bg-gray-600" data-filter="errors" onclick="filterActivity('errors', event)">Errors</button>
                    </div>
                    
                    <!-- Activity Search -->
                    <input type="text" id="activity-search" placeholder="Search activity..." class="w-full px-3 py-2 mb-4 bg-gray-800 border border-gray-700 rounded text-sm focus:outline-none focus:ring-2 focus:ring-blue-500" onkeyup="searchActivity()">
                    
                    <!-- Activity Feed -->
                    <div id="recent-activity" class="space-y-3 max-h-80 overflow-y-auto">
                        <!-- Activity items will be inserted here -->
                        <div class="text-center text-gray-500 py-4">
                            <i class="fas fa-sync-alt fa-spin mb-2"></i>
                            <p class="text-sm">Loading activity...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Trades Page -->
        <div id="page-trades" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Trading History</h2>
                <p class="text-gray-400">View and analyze all your trades</p>
            </div>
            
            <!-- Filters -->
            <div class="card bg-dark-card rounded-xl p-6 border border-dark-border mb-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Date Range</label>
                        <select class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm" id="trade-date-filter">
                            <option value="all">All Time</option>
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Symbol</label>
                        <select class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm" id="trade-symbol-filter">
                            <option value="">All Symbols</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Strategy</label>
                        <select class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm" id="trade-strategy-filter">
                            <option value="">All Strategies</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Outcome</label>
                        <select class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm" id="trade-outcome-filter">
                            <option value="">All</option>
                            <option value="win">Wins</option>
                            <option value="loss">Losses</option>
                        </select>
                    </div>
                </div>
                <div class="mt-4 flex justify-between items-center">
                    <button onclick="applyTradeFilters()" class="btn-primary px-6 py-2 rounded-lg text-sm font-medium">
                        Apply Filters
                    </button>
                    <button onclick="exportTrades()" class="px-6 py-2 rounded-lg text-sm font-medium bg-gray-700 hover:bg-gray-600">
                        <i class="fas fa-download mr-2"></i>Export CSV
                    </button>
                </div>
            </div>
            
            <!-- Trades Table -->
            <div class="card bg-dark-card rounded-xl border border-dark-border overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-800 border-b border-gray-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">ID</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Symbol</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Strategy</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Entry</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Exit</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">Duration</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase">P&L</th>
                            </tr>
                        </thead>
                        <tbody id="trades-table-body" class="divide-y divide-gray-700">
                            <!-- Trades will be inserted here -->
                        </tbody>
                    </table>
                </div>
                <div class="bg-gray-800 px-6 py-4 flex justify-between items-center">
                    <div class="text-sm text-gray-400" id="trades-count">Showing 0 trades</div>
                    <div class="flex space-x-2" id="trades-pagination">
                        <!-- Pagination buttons will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Opportunities Page -->
        <div id="page-opportunities" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Trading Opportunities</h2>
                <p class="text-gray-400">Real-time detected trading opportunities across all strategies</p>
            </div>

            <!-- Filters -->
            <div class="card bg-dark-card rounded-xl p-6 border border-dark-border mb-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Strategy</label>
                        <select id="opp-filter-strategy" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm">
                            <option value="">All Strategies</option>
                            <option value="RSI Scalp">RSI Scalp</option>
                            <option value="Momentum">Momentum</option>
                            <option value="MACD Trend">MACD Trend</option>
                            <option value="Arbitrage">Arbitrage</option>
                            <option value="Mean Reversion">Mean Reversion</option>
                            <option value="Breakout">Breakout</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Symbol</label>
                        <input type="text" id="opp-filter-symbol" placeholder="e.g., AAPL" 
                               class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-400 mb-2">Status</label>
                        <select id="opp-filter-status" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2 text-sm">
                            <option value="">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="executed">Executed</option>
                            <option value="rejected">Rejected</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button id="opp-apply-filters-btn" 
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium transition">
                            <i class="fas fa-filter mr-2"></i>Apply Filters
                        </button>
                    </div>
                </div>
            </div>

            <!-- Opportunities Table -->
            <div class="card bg-dark-card rounded-xl border border-dark-border overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-800">
                            <tr>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Timestamp</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Symbol</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Strategy</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Signal</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Confidence</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Price</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-4 text-left text-xs font-semibold text-gray-400 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="opportunities-table-body" class="divide-y divide-gray-700">
                            <!-- Opportunities will be inserted here -->
                        </tbody>
                    </table>
                </div>
                <div class="px-6 py-4 bg-gray-800 text-sm text-gray-400" id="opportunities-count">
                    Loading opportunities...
                </div>
            </div>
        </div>
        
        <!-- Analytics Page -->
        <div id="page-analytics" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Advanced Analytics</h2>
                <p class="text-gray-400">Performance attribution, risk metrics, and detailed comparisons</p>
            </div>
            
            <!-- Analytics Sections -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <!-- Performance Attribution -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h3 class="text-xl font-semibold mb-4"><i class="fas fa-chart-pie mr-2 text-blue-500"></i>Performance Attribution</h3>
                    <p class="text-gray-400 mb-4">Analyze P&L by strategy, symbol, time, and day of week</p>
                    <div class="text-center py-8">
                        <i class="fas fa-chart-pie text-4xl text-gray-600 mb-2"></i>
                        <p class="text-sm text-gray-500">Portfolio breakdown chart will appear here when data is available</p>
                    </div>
                </div>
                
                <!-- Risk Analytics -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h3 class="text-xl font-semibold mb-4"><i class="fas fa-shield-alt mr-2 text-red-500"></i>Risk Analytics</h3>
                    <p class="text-gray-400 mb-4">Sharpe Ratio, Sortino, Max DD, VaR, Beta, Volatility</p>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-gray-800 rounded-lg p-4">
                            <p class="text-xs text-gray-400 mb-1">Sharpe Ratio</p>
                            <p class="text-2xl font-bold">--</p>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4">
                            <p class="text-xs text-gray-400 mb-1">Max Drawdown</p>
                            <p class="text-2xl font-bold text-red-400">--</p>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4">
                            <p class="text-xs text-gray-400 mb-1">Sortino Ratio</p>
                            <p class="text-2xl font-bold">--</p>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4">
                            <p class="text-xs text-gray-400 mb-1">Volatility</p>
                            <p class="text-2xl font-bold">--</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Comparison Tools -->
            <div class="card bg-dark-card rounded-xl p-6 border border-dark-border mb-6">
                <h3 class="text-xl font-semibold mb-4"><i class="fas fa-balance-scale mr-2 text-green-500"></i>Comparison Tools</h3>
                <p class="text-gray-400 mb-4">Compare your bot vs market benchmarks and strategies</p>
                <div class="text-center py-8">
                    <i class="fas fa-balance-scale text-4xl text-gray-600 mb-2"></i>
                    <p class="text-sm text-gray-500">Strategy comparison benchmarks (SPY, QQQ) will be available when multiple strategies are active</p>
                </div>
            </div>
            
            <!-- Heatmaps -->
            <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                <h3 class="text-xl font-semibold mb-4"><i class="fas fa-th mr-2 text-purple-500"></i>Performance Heatmaps</h3>
                <p class="text-gray-400 mb-4">Visualize performance by time, strategy, and symbol</p>
                <div class="text-center py-8">
                    <i class="fas fa-th text-4xl text-gray-600 mb-2"></i>
                    <p class="text-sm text-gray-500">Time-based performance heatmaps (hour, day, month) will appear when sufficient trading data is collected</p>
                </div>
            </div>
        </div>
        
        <!-- Tax Page -->
        <div id="page-tax" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Tax Dashboard</h2>
                <p class="text-gray-400">IRS-compliant tax reporting and capital gains tracking</p>
            </div>
            
            <!-- YTD Summary -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <p class="text-sm text-gray-400 mb-2">Total Realized Gains</p>
                    <p class="text-3xl font-bold text-profit">$--</p>
                    <p class="text-xs text-gray-500 mt-1">YTD</p>
                </div>
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <p class="text-sm text-gray-400 mb-2">Short-term Gains</p>
                    <p class="text-3xl font-bold">$--</p>
                    <p class="text-xs text-gray-500 mt-1">&lt; 1 year holding</p>
                </div>
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <p class="text-sm text-gray-400 mb-2">Long-term Gains</p>
                    <p class="text-3xl font-bold">$--</p>
                    <p class="text-xs text-gray-500 mt-1">&gt; 1 year holding</p>
                </div>
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <p class="text-sm text-gray-400 mb-2">Net Capital Gain/Loss</p>
                    <p class="text-3xl font-bold">$--</p>
                    <p class="text-xs text-gray-500 mt-1">After losses</p>
                </div>
            </div>
            
            <!-- Export Options -->
            <div class="card bg-dark-card rounded-xl p-6 border border-dark-border mb-6">
                <h3 class="text-xl font-semibold mb-4"><i class="fas fa-file-export mr-2 text-blue-500"></i>Export Tax Reports</h3>
                <p class="text-gray-400 mb-4">Generate IRS-compliant reports for your tax software</p>
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <button class="px-4 py-3 bg-blue-600 hover:bg-blue-700 rounded-lg text-white font-medium transition">
                        <i class="fas fa-file-invoice mr-2"></i>TurboTax (TXF)
                    </button>
                    <button class="px-4 py-3 bg-green-600 hover:bg-green-700 rounded-lg text-white font-medium transition">
                        <i class="fas fa-file-alt mr-2"></i>H&R Block (CSV)
                    </button>
                    <button class="px-4 py-3 bg-red-600 hover:bg-red-700 rounded-lg text-white font-medium transition">
                        <i class="fas fa-file-pdf mr-2"></i>IRS Form 8949
                    </button>
                    <button class="px-4 py-3 bg-gray-600 hover:bg-gray-700 rounded-lg text-white font-medium transition">
                        <i class="fas fa-table mr-2"></i>Raw CSV
                    </button>
                </div>
            </div>
            
            <!-- Trade Details Table -->
            <div class="card bg-dark-card rounded-xl border border-dark-border overflow-hidden">
                <div class="px-6 py-4 bg-gray-800 border-b border-dark-border">
                    <h3 class="text-lg font-semibold"><i class="fas fa-list mr-2"></i>Trade Details (Form 8949 Format)</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-800">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase">Symbol</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase">Buy Date</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase">Sell Date</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase">Days Held</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase">Proceeds</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase">Cost Basis</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase">Gain/Loss</th>
                                <th class="px-6 py-3 text-left text-xs font-semibold text-gray-400 uppercase">Type</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-700">
                            <tr>
                                <td colspan="8" class="px-6 py-8 text-center text-gray-400">
                                    <i class="fas fa-file-invoice text-3xl mb-2"></i>
                                    <p>No tax data available. Start trading to generate tax reports.</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Settings Page -->
        <div id="page-settings" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Settings</h2>
                <p class="text-gray-400">Configure notifications, strategies, and preferences</p>
            </div>
            
            <!-- Settings Tabs -->
            <div class="mb-6">
                <div class="flex space-x-4 border-b border-dark-border">
                    <button onclick="showSettingsTab('notifications', event)" class="settings-tab px-4 py-2 font-medium border-b-2 border-blue-500 text-blue-500">
                        <i class="fas fa-bell mr-2"></i>Notifications
                    </button>
                    <button onclick="showSettingsTab('display', event)" class="settings-tab px-4 py-2 font-medium text-gray-400 hover:text-white">
                        <i class="fas fa-palette mr-2"></i>Display
                    </button>
                    <button onclick="showSettingsTab('strategies', event)" class="settings-tab px-4 py-2 font-medium text-gray-400 hover:text-white">
                        <i class="fas fa-chess mr-2"></i>Strategies
                    </button>
                    <button onclick="showSettingsTab('datasources', event)" class="settings-tab px-4 py-2 font-medium text-gray-400 hover:text-white">
                        <i class="fas fa-database mr-2"></i>Data Sources
                    </button>
                </div>
            </div>
            
            <!-- Notifications Settings -->
            <div id="settings-notifications" class="settings-content">
                <!-- Email Notifications -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-envelope text-blue-500 mr-3"></i>
                                Email Notifications
                            </h3>
                            <p class="text-sm text-gray-400 mt-1">Receive trading alerts via email</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="email-enabled" class="sr-only peer" onchange="toggleEmailSettings()">
                            <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    
                    <div id="email-settings" class="space-y-4 hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">From Email</label>
                                <input type="email" id="email-from" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2" placeholder="your@email.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">To Email</label>
                                <input type="email" id="email-to" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2" placeholder="alerts@email.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">SMTP Server</label>
                                <input type="text" id="email-smtp" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2" placeholder="smtp.gmail.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">SMTP Port</label>
                                <input type="number" id="email-port" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2" placeholder="587">
                            </div>
                            <div class="md:col-span-2">
                                <label class="block text-sm font-medium text-gray-400 mb-2">Password</label>
                                <input type="password" id="email-password" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                            </div>
                        </div>
                        
                        <div class="flex space-x-4">
                            <button onclick="testEmailNotification()" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-700 hover:bg-gray-600">
                                <i class="fas fa-paper-plane mr-2"></i>Send Test Email
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Desktop Notifications -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fas fa-desktop text-green-500 mr-3"></i>
                                Desktop Notifications
                            </h3>
                            <p class="text-sm text-gray-400 mt-1">Show notifications on your desktop</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="desktop-enabled" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    
                    <button onclick="testDesktopNotification()" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-700 hover:bg-gray-600">
                        <i class="fas fa-bell mr-2"></i>Send Test Notification
                    </button>
                </div>
                
                <!-- Telegram Notifications -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <div>
                            <h3 class="text-lg font-semibold flex items-center">
                                <i class="fab fa-telegram text-cyan-500 mr-3"></i>
                                Telegram Notifications
                            </h3>
                            <p class="text-sm text-gray-400 mt-1">Receive alerts via Telegram</p>
                        </div>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="telegram-enabled" class="sr-only peer" onchange="toggleTelegramSettings()">
                            <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    
                    <div id="telegram-settings" class="space-y-4 hidden">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Bot Token</label>
                                <input type="text" id="telegram-token" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2" placeholder="123456:ABC-DEF...">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-400 mb-2">Chat ID</label>
                                <input type="text" id="telegram-chat-id" class="w-full bg-gray-700 border border-gray-600 rounded-lg px-3 py-2" placeholder="123456789">
                            </div>
                        </div>
                        
                        <button onclick="testTelegramNotification()" class="px-4 py-2 rounded-lg text-sm font-medium bg-gray-700 hover:bg-gray-600">
                            <i class="fab fa-telegram mr-2"></i>Send Test Message
                        </button>
                    </div>
                </div>
                
                <!-- Save Button -->
                <div class="flex justify-end">
                    <button onclick="saveNotificationSettings()" class="btn-primary px-8 py-3 rounded-lg font-medium">
                        <i class="fas fa-save mr-2"></i>Save All Settings
                    </button>
                </div>
            </div>
            
            <!-- Strategies Settings -->
            <div id="settings-strategies" class="settings-content hidden">
                <div class="text-center py-20">
                    <i class="fas fa-chess text-6xl text-gray-600 mb-4"></i>
                    <p class="text-xl text-gray-400">Strategy configuration is managed in config.yaml</p>
                    <p class="text-sm text-gray-500 mt-2">Edit the config file to add or modify trading strategies</p>
                </div>
            </div>
            
            <!-- Display Settings -->
            <div id="settings-display" class="settings-content hidden">
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border mb-6">
                    <h3 class="text-lg font-semibold mb-4"><i class="fas fa-moon mr-2 text-purple-500"></i>Theme Settings</h3>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <button class="p-4 bg-gray-800 hover:bg-gray-700 rounded-lg border-2 border-blue-500 transition">
                            <i class="fas fa-moon text-2xl mb-2"></i>
                            <p class="font-medium">Dark Mode</p>
                            <p class="text-xs text-gray-400">Current</p>
                        </button>
                        <button class="p-4 bg-gray-800 hover:bg-gray-700 rounded-lg border-2 border-transparent hover:border-gray-600 transition" disabled title="Theme customization not yet available">
                            <i class="fas fa-sun text-2xl mb-2"></i>
                            <p class="font-medium">Light Mode</p>
                            <p class="text-xs text-gray-500">Not available</p>
                        </button>
                        <button class="p-4 bg-gray-800 hover:bg-gray-700 rounded-lg border-2 border-transparent hover:border-gray-600 transition" disabled title="Custom themes not yet available">
                            <i class="fas fa-palette text-2xl mb-2"></i>
                            <p class="font-medium">Custom</p>
                            <p class="text-xs text-gray-500">Not available</p>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Data Sources Settings -->
            <div id="settings-datasources" class="settings-content hidden">
                <!-- Data Mode Toggle -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border mb-6">
                    <h3 class="text-lg font-semibold mb-4"><i class="fas fa-toggle-on mr-2 text-blue-500"></i>Data Mode</h3>
                    <p class="text-sm text-gray-400 mb-4">Choose between live market data or historical data only</p>
                    <div class="bg-yellow-900/20 border border-yellow-600 rounded-lg p-4 mb-4">
                        <p class="text-yellow-400 text-sm"><i class="fas fa-exclamation-triangle mr-2"></i>NEVER MIX BOTH - Clear visual separation between live and historical data</p>
                    </div>
                    <div class="space-y-3">
                        <label class="flex items-center p-4 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700 transition">
                            <input type="radio" name="data-mode" value="live" class="w-4 h-4 text-blue-600">
                            <div class="ml-3">
                                <p class="font-medium">â— Live APIs (real-time market data)</p>
                                <p class="text-xs text-gray-400">Connect to real-time market data sources</p>
                            </div>
                        </label>
                        <label class="flex items-center p-4 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700 transition">
                            <input type="radio" name="data-mode" value="historical" checked class="w-4 h-4 text-blue-600">
                            <div class="ml-3">
                                <p class="font-medium">â—‹ Historical Only (backtest data only)</p>
                                <p class="text-xs text-gray-400">Use only historical data for backtesting</p>
                            </div>
                        </label>
                    </div>
                </div>
                
                <!-- Connected APIs -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border mb-6">
                    <h3 class="text-lg font-semibold mb-4"><i class="fas fa-plug mr-2 text-green-500"></i>Connected APIs</h3>
                    <p class="text-sm text-gray-400 mb-4">Enable and configure data source APIs</p>
                    <div class="space-y-3">
                        <!-- Alpaca -->
                        <div class="flex items-center justify-between p-4 bg-gray-800 rounded-lg">
                            <div class="flex items-center">
                                <input type="checkbox" checked class="w-4 h-4 text-blue-600 mr-3">
                                <div>
                                    <p class="font-medium">Alpaca API</p>
                                    <p class="text-xs text-gray-400">Stock trading and market data</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm transition">Configure</button>
                                <button class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm transition">Test</button>
                            </div>
                        </div>
                        
                        <!-- Yahoo Finance -->
                        <div class="flex items-center justify-between p-4 bg-gray-800 rounded-lg">
                            <div class="flex items-center">
                                <input type="checkbox" checked class="w-4 h-4 text-blue-600 mr-3">
                                <div>
                                    <p class="font-medium">Yahoo Finance</p>
                                    <p class="text-xs text-gray-400">Free market data (no API key required)</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm transition">Test</button>
                            </div>
                        </div>
                        
                        <!-- Alpha Vantage -->
                        <div class="flex items-center justify-between p-4 bg-gray-800 rounded-lg">
                            <div class="flex items-center">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 mr-3">
                                <div>
                                    <p class="font-medium">Alpha Vantage</p>
                                    <p class="text-xs text-gray-400">Market data and technical indicators</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm transition">Configure</button>
                                <button class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm transition">Test</button>
                            </div>
                        </div>
                        
                        <!-- IEX Cloud -->
                        <div class="flex items-center justify-between p-4 bg-gray-800 rounded-lg">
                            <div class="flex items-center">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 mr-3">
                                <div>
                                    <p class="font-medium">IEX Cloud</p>
                                    <p class="text-xs text-gray-400">Real-time and historical market data</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm transition">Configure</button>
                                <button class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm transition">Test</button>
                            </div>
                        </div>
                        
                        <!-- Finnhub -->
                        <div class="flex items-center justify-between p-4 bg-gray-800 rounded-lg">
                            <div class="flex items-center">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 mr-3">
                                <div>
                                    <p class="font-medium">Finnhub</p>
                                    <p class="text-xs text-gray-400">Real-time stock market data</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm transition">Configure</button>
                                <button class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm transition">Test</button>
                            </div>
                        </div>
                        
                        <!-- Twelve Data -->
                        <div class="flex items-center justify-between p-4 bg-gray-800 rounded-lg">
                            <div class="flex items-center">
                                <input type="checkbox" class="w-4 h-4 text-blue-600 mr-3">
                                <div>
                                    <p class="font-medium">Twelve Data</p>
                                    <p class="text-xs text-gray-400">Real-time and historical data</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button class="px-3 py-1 bg-blue-600 hover:bg-blue-700 rounded text-sm transition">Configure</button>
                                <button class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded text-sm transition">Test</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Trading Mode -->
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h3 class="text-lg font-semibold mb-4"><i class="fas fa-shield-alt mr-2 text-yellow-500"></i>Trading Mode</h3>
                    <p class="text-sm text-gray-400 mb-4">Switch between paper trading and live trading</p>
                    <div class="space-y-3">
                        <label class="flex items-center p-4 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700 transition">
                            <input type="radio" name="trading-mode" value="paper" checked class="w-4 h-4 text-blue-600">
                            <div class="ml-3">
                                <p class="font-medium">â—‹ Paper Trading</p>
                                <p class="text-xs text-gray-400">Simulated trading with virtual money (current)</p>
                            </div>
                        </label>
                        <label class="flex items-center p-4 bg-gray-800 rounded-lg cursor-pointer hover:bg-gray-700 transition">
                            <input type="radio" name="trading-mode" value="live" class="w-4 h-4 text-red-600">
                            <div class="ml-3">
                                <p class="font-medium text-red-400">â—‹ Live Trading</p>
                                <p class="text-xs text-red-400">REAL MONEY - Requires confirmation modal</p>
                            </div>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Strategies Page (Phase 6A: enable/disable, config, leaderboard) -->
        <div id="page-strategies" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Strategies</h2>
                <p class="text-gray-400">Enable or disable strategies, configure parameters, view leaderboard</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h3 class="text-lg font-semibold mb-2"><i class="fas fa-trophy text-yellow-500 mr-2"></i>Strategy Leaderboard</h3>
                    <p class="text-sm text-gray-400 mb-4">Rankings from strategy competition (DB). Run the engine to see live rankings.</p>
                    <a href="/leaderboard" class="inline-flex items-center px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-sm font-medium">
                        Open Leaderboard <i class="fas fa-external-link-alt ml-2"></i>
                    </a>
                </div>
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h3 class="text-lg font-semibold mb-2"><i class="fas fa-cog text-gray-400 mr-2"></i>Strategy Config</h3>
                    <p class="text-sm text-gray-400 mb-4">Enable/disable strategies and set parameters in config. Engine reads config at startup.</p>
                    <button onclick="showPage('settings', event)" class="inline-flex items-center px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-sm font-medium">
                        Open Settings <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
            <div class="card bg-dark-card rounded-xl p-6 border border-dark-border border-amber-500/30">
                <p class="text-sm text-amber-200/90"><i class="fas fa-info-circle mr-2"></i>Clone / save presets: not yet supported by backend. Shown when API is available.</p>
            </div>
        </div>

        <!-- Markets & Charts Page (Phase 6A: live prices, indicators, timeframes) -->
        <div id="page-markets" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Markets &amp; Charts</h2>
                <p class="text-gray-400">Live prices and P&amp;L charts (from trade history when engine not running)</p>
            </div>
            <p class="text-sm text-gray-400 mb-4">Crypto ticker at top uses external APIs. Charts below use <code class="bg-gray-800 px-1 rounded">logs/trades.csv</code>.</p>
            <div class="grid grid-cols-1 gap-6">
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h3 class="text-lg font-semibold mb-2">Cumulative P&amp;L</h3>
                    <div class="h-64"><canvas id="markets-cumulative-pnl" aria-label="Cumulative P&L"></canvas></div>
                </div>
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h3 class="text-lg font-semibold mb-2">Daily P&amp;L</h3>
                    <div class="h-64"><canvas id="markets-daily-pnl" aria-label="Daily P&L"></canvas></div>
                </div>
            </div>
            <p class="text-xs text-gray-500 mt-4">Full analytics: <button onclick="showPage('analytics', event)" class="text-blue-400 hover:underline">Analytics</button></p>
        </div>

        <!-- Execution Page (Phase 6A: paper status, positions, trade log) -->
        <div id="page-execution" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Execution</h2>
                <p class="text-gray-400">Paper trading status, positions, and recent activity (read-only from engine state)</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="card bg-dark-card rounded-xl p-4 border border-dark-border">
                    <span class="text-xs text-gray-400 uppercase">Paper status</span>
                    <p class="text-xl font-semibold mt-1" id="exec-status">â€”</p>
                    <p class="text-xs text-gray-500 mt-1" id="exec-last-update">â€”</p>
                </div>
                <div class="card bg-dark-card rounded-xl p-4 border border-dark-border">
                    <span class="text-xs text-gray-400 uppercase">Balance</span>
                    <p class="text-xl font-semibold mt-1" id="exec-balance">â€”</p>
                </div>
                <div class="card bg-dark-card rounded-xl p-4 border border-dark-border">
                    <span class="text-xs text-gray-400 uppercase">Open positions</span>
                    <p class="text-xl font-semibold mt-1" id="exec-positions-count">0</p>
                </div>
            </div>
            <div class="card bg-dark-card rounded-xl border border-dark-border mb-6 overflow-hidden">
                <h3 class="px-6 py-3 border-b border-dark-border font-semibold">Positions</h3>
                <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                        <thead class="bg-gray-800 border-b border-gray-700">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs text-gray-400 uppercase">Symbol / Market</th>
                                <th class="px-4 py-2 text-right text-xs text-gray-400 uppercase">Quantity</th>
                                <th class="px-4 py-2 text-right text-xs text-gray-400 uppercase">Avg price</th>
                                <th class="px-4 py-2 text-right text-xs text-gray-400 uppercase">Current value</th>
                            </tr>
                        </thead>
                        <tbody id="exec-positions-body" class="divide-y divide-gray-700">
                            <tr><td colspan="4" class="px-4 py-4 text-gray-500 text-center">Loadingâ€¦</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="card bg-dark-card rounded-xl border border-dark-border overflow-hidden">
                <h3 class="px-6 py-3 border-b border-dark-border font-semibold">Recent activity <span class="text-xs font-normal text-gray-400">(logs/activity.json)</span></h3>
                <div id="exec-activity-list" class="divide-y divide-gray-700 max-h-96 overflow-y-auto">
                    <div class="px-6 py-4 text-gray-500 text-center">Loadingâ€¦</div>
                </div>
            </div>
        </div>

        <!-- Results & Analysis Page (Phase 6A: backtests, comparisons, leaderboard) -->
        <div id="page-results" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Results &amp; Analysis</h2>
                <p class="text-gray-400">Backtests, strategy comparison, and leaderboard</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <a href="/leaderboard" class="card bg-dark-card rounded-xl p-6 border border-dark-border hover:border-blue-500/50 transition block">
                    <i class="fas fa-trophy text-2xl text-yellow-500 mb-2"></i>
                    <h3 class="font-semibold">Leaderboard</h3>
                    <p class="text-sm text-gray-400">Strategy rankings</p>
                </a>
                <a href="/strategy_comparison" class="card bg-dark-card rounded-xl p-6 border border-dark-border hover:border-blue-500/50 transition block">
                    <i class="fas fa-chart-bar text-2xl text-blue-500 mb-2"></i>
                    <h3 class="font-semibold">Strategy comparison</h3>
                    <p class="text-sm text-gray-400">Compare performance</p>
                </a>
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border opacity-90">
                    <i class="fas fa-vial text-2xl text-gray-500 mb-2"></i>
                    <h3 class="font-semibold">Backtest</h3>
                    <p class="text-sm text-gray-400">Run via API; UI trigger in Strategy comparison / Analytics</p>
                </div>
            </div>
            <button onclick="showPage('analytics', event)" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-sm">Open Analytics</button>
        </div>

        <!-- System Status Page (Phase 6A: logs, diagnostics, alerts) -->
        <div id="page-system" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">System Status</h2>
                <p class="text-gray-400">Logs, health, and alerts</p>
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="card bg-dark-card rounded-xl border border-dark-border overflow-hidden">
                    <h3 class="px-6 py-3 border-b border-dark-border font-semibold">Recent logs</h3>
                    <pre id="system-logs" class="p-4 text-xs overflow-auto max-h-64 bg-gray-900/50 font-mono text-gray-300">Loadingâ€¦</pre>
                </div>
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h3 class="font-semibold mb-2">Health</h3>
                    <p class="text-sm text-gray-400 mb-2">Dashboard and engine state (read-only).</p>
                    <a href="/api/health" target="_blank" rel="noopener" class="text-blue-400 hover:underline text-sm">/api/health</a>
                    <p class="text-sm text-gray-500 mt-2" id="system-health-summary">â€”</p>
                </div>
            </div>
            <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                <h3 class="font-semibold mb-2">Configuration &amp; safety</h3>
                <p class="text-sm text-gray-400 mb-4">Trading mode, API keys, and system config. Start/stop engine via terminal (python run_bot.py / bot.py).</p>
                <a href="/system-settings" class="inline-block px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-sm font-medium mr-2">System &amp; Settings</a>
                <a href="/alerts" class="inline-block px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-sm mr-2">Alerts</a>
                <button onclick="showPage('control', event)" class="px-4 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-sm">Control</button>
            </div>
        </div>

        <!-- Control Page -->
        <div id="page-control" class="page-content hidden">
            <div class="mb-8">
                <h2 class="text-3xl font-bold mb-2">Bot Control</h2>
                <p class="text-gray-400">Start, stop, and monitor your trading bot</p>
            </div>
            <div class="card bg-dark-card rounded-xl p-6 border border-amber-500/30 mb-4">
                <p class="text-sm text-amber-200/90"><i class="fas fa-info-circle mr-2"></i>Engine runs via <code>python run_bot.py</code> or <code>python bot.py</code>. Use the TUI for pause/resume. Dashboard is read-only.</p>
            </div>
            <!-- Control Panel -->
            <div class="card bg-dark-card rounded-xl p-8 border border-dark-border mb-6 text-center">
                <div class="mb-6">
                    <div class="inline-block p-4 bg-gray-800 rounded-full mb-4">
                        <i class="fas fa-robot text-6xl text-blue-500"></i>
                    </div>
                    <h3 class="text-2xl font-bold mb-2">Bot Status: <span id="control-status">Stopped</span></h3>
                    <p class="text-gray-400">Uptime: <span id="bot-uptime">0h 0m</span></p>
                </div>
                
                <div class="flex justify-center space-x-4">
                    <button onclick="startBot()" class="px-8 py-4 rounded-lg font-medium bg-green-600 hover:bg-green-700 transition" title="Process start not supported from dashboard">
                        <i class="fas fa-play mr-2"></i>Start Bot
                    </button>
                    <button onclick="stopBot()" class="px-8 py-4 rounded-lg font-medium bg-red-600 hover:bg-red-700 transition" title="Process stop not supported from dashboard">
                        <i class="fas fa-stop mr-2"></i>Stop Bot
                    </button>
                    <button onclick="restartBot()" class="px-8 py-4 rounded-lg font-medium bg-yellow-600 hover:bg-yellow-700 transition" title="Process restart not supported from dashboard">
                        <i class="fas fa-redo mr-2"></i>Restart Bot
                    </button>
                </div>
            </div>
            
            <!-- System Info -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h4 class="text-sm text-gray-400 mb-2">Mode</h4>
                    <p class="text-xl font-semibold" id="bot-mode">Paper Trading</p>
                </div>
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h4 class="text-sm text-gray-400 mb-2">Connected Symbols</h4>
                    <p class="text-xl font-semibold" id="connected-symbols">0</p>
                </div>
                <div class="card bg-dark-card rounded-xl p-6 border border-dark-border">
                    <h4 class="text-sm text-gray-400 mb-2">Active Strategies</h4>
                    <p class="text-xl font-semibold" id="active-strategies-count">0</p>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-4 right-4 hidden">
        <div class="bg-gray-800 border border-gray-700 rounded-lg shadow-lg p-4 max-w-sm">
            <div class="flex items-center">
                <i id="toast-icon" class="fas fa-check-circle text-green-500 text-xl mr-3"></i>
                <p id="toast-message" class="text-sm"></p>
            </div>
        </div>
    </div>
    
    <!-- Socket.IO for WebSocket support -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- NEW: Load notification and chart libraries -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/loading.css') }}">
    <script src="{{ url_for('static', filename='js/notifications.js') }}"></script>
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
    
    <!-- Load utilities first, then realtime client, then dashboard -->
    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chart-init.js') }}"></script>
    <script src="{{ url_for('static', filename='js/realtime_client.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
    <script src="{{ url_for('static', filename='js/crypto_ticker.js') }}"></script>
    
    <!-- New UX Feature Scripts -->
    <script src="{{ url_for('static', filename='js/touch_gestures.js') }}"></script>
    <script src="{{ url_for('static', filename='js/keyboard_shortcuts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/command_palette.js') }}"></script>
    <script src="{{ url_for('static', filename='js/enhanced_charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/favorites.js') }}"></script>
    <script src="{{ url_for('static', filename='js/debug_panel.js') }}"></script>
    
    <!-- WebSocket Real-Time Updates -->
    <script>
        // Initialize WebSocket connection
        const socket = io();
        
        socket.on('connect', function() {
            console.log('WebSocket connected');
        });
        
        socket.on('portfolio_update', function(data) {
            console.log('Portfolio update received:', data);
            updatePortfolioDisplay(data);
        });
        
        socket.on('trades_update', function(data) {
            console.log('Trades update received:', data);
            updateTradesTable(data);
        });
        
        socket.on('strategies_update', function(data) {
            console.log('Strategies update received:', data);
            updateStrategyCards(data);
        });
        
        socket.on('alerts_update', function(data) {
            console.log('Alerts update received:', data);
            if (data && data.length > 0) {
                data.forEach(alert => {
                    showNotification(alert.message, alert.type || 'info');
                });
            }
        });
        
        // Update functions
        function updatePortfolioDisplay(data) {
            if (!data) return;
            
            // Update portfolio values in the dashboard
            if (data.total_value !== undefined) {
                const el = document.getElementById('portfolio-value');
                if (el) el.textContent = '$' + data.total_value.toLocaleString();
            }
            
            if (data.total_return !== undefined) {
                const el = document.getElementById('total-return');
                if (el) {
                    el.textContent = '$' + data.total_return.toLocaleString();
                    el.className = data.total_return >= 0 ? 'text-profit' : 'text-loss';
                }
            }
            
            if (data.total_return_pct !== undefined) {
                const el = document.getElementById('return-pct');
                if (el) {
                    el.textContent = data.total_return_pct.toFixed(2) + '%';
                    el.className = data.total_return_pct >= 0 ? 'text-profit' : 'text-loss';
                }
            }
        }
        
        function updateTradesTable(trades) {
            if (!trades || trades.length === 0) return;
            
            const tableBody = document.getElementById('trades-table-body');
            if (!tableBody) return;
            
            // Add new trades to the top of the table
            trades.forEach(trade => {
                const row = document.createElement('tr');
                row.className = 'border-b border-dark-border hover:bg-gray-800';
                row.innerHTML = `
                    <td class="px-4 py-3">${new Date(trade.timestamp).toLocaleString()}</td>
                    <td class="px-4 py-3">${trade.symbol}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 rounded ${trade.side === 'BUY' ? 'bg-green-900 text-green-300' : 'bg-red-900 text-red-300'}">${trade.side}</span></td>
                    <td class="px-4 py-3">${trade.quantity}</td>
                    <td class="px-4 py-3">$${trade.price.toFixed(2)}</td>
                    <td class="px-4 py-3 ${trade.pnl >= 0 ? 'text-profit' : 'text-loss'}">$${trade.pnl.toFixed(2)}</td>
                `;
                tableBody.insertBefore(row, tableBody.firstChild);
                
                // Keep only last 20 rows
                if (tableBody.children.length > 20) {
                    tableBody.removeChild(tableBody.lastChild);
                }
            });
        }
        
        function updateStrategyCards(strategies) {
            if (!strategies) return;
            
            Object.keys(strategies).forEach(strategyName => {
                const stats = strategies[strategyName];
                const card = document.getElementById(`strategy-${strategyName}`);
                
                if (card) {
                    const tradesEl = card.querySelector('.strategy-trades');
                    const pnlEl = card.querySelector('.strategy-pnl');
                    
                    if (tradesEl) tradesEl.textContent = stats.trades;
                    if (pnlEl) {
                        pnlEl.textContent = '$' + stats.total_pnl.toFixed(2);
                        pnlEl.className = 'strategy-pnl ' + (stats.total_pnl >= 0 ? 'text-profit' : 'text-loss');
                    }
                }
            });
        }
        
        // Auto-refresh dashboard every 30 seconds
        setInterval(function() {
            fetch('/api/dashboard/refresh')
                .then(r => r.json())
                .then(data => {
                    if (data.summary) {
                        updatePortfolioDisplay(data.summary);
                    }
                    if (data.recent_trades) {
                        updateTradesTable(data.recent_trades);
                    }
                })
                .catch(error => console.error('Auto-refresh error:', error));
        }, 30000);
    </script>
</body>
</html>
