# Prometheus alerting rules
groups:
  - name: trading_bot_alerts
    interval: 30s
    rules:
      # Bot is down
      - alert: BotDown
        expr: up{job="trading-bot"} == 0
        for: 2m
        labels:
          severity: critical
        annotations:
          summary: "Trading bot is down"
          description: "The trading bot has been down for more than 2 minutes."

      # High error rate
      - alert: HighErrorRate
        expr: rate(bot_errors_total[5m]) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value }} errors per second."

      # High API failure rate
      - alert: HighAPIFailureRate
        expr: rate(api_failures_total[5m]) > 0.2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "High API failure rate"
          description: "API failure rate is {{ $value }} per second."

      # Missed opportunities
      - alert: MissedOpportunities
        expr: increase(opportunities_missed_total[10m]) > 5
        for: 5m
        labels:
          severity: info
        annotations:
          summary: "Multiple opportunities missed"
          description: "{{ $value }} opportunities were missed in the last 10 minutes."

      # Low profitability
      - alert: LowProfitability
        expr: rate(paper_profit_total[1h]) < 0.01
        for: 30m
        labels:
          severity: info
        annotations:
          summary: "Low profitability detected"
          description: "Profit rate is only {{ $value }} in the last hour."

      # Memory usage high
      - alert: HighMemoryUsage
        expr: (process_resident_memory_bytes / 1024 / 1024) > 500
        for: 10m
        labels:
          severity: warning
        annotations:
          summary: "High memory usage"
          description: "Bot is using {{ $value }}MB of memory."
