<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Strategy Testing Bot - Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Header with Control Panel -->
    <header class="header">
        <div class="header-content">
            <h1 class="title">
                <i class="fas fa-chart-line"></i>
                Market Strategy Testing Bot
            </h1>
            <div class="controls">
                <button id="btn-start" class="btn btn-success" onclick="controlBot('start')">
                    <i class="fas fa-play"></i> Start
                </button>
                <button id="btn-pause" class="btn btn-warning" onclick="controlBot('pause')">
                    <i class="fas fa-pause"></i> Pause
                </button>
                <button id="btn-stop" class="btn btn-danger" onclick="controlBot('stop')">
                    <i class="fas fa-stop"></i> Stop
                </button>
                <button id="btn-restart" class="btn btn-info" onclick="controlBot('restart')">
                    <i class="fas fa-redo"></i> Restart
                </button>
                <button id="btn-refresh" class="btn btn-secondary" onclick="refreshData()">
                    <i class="fas fa-sync"></i> Refresh
                </button>
            </div>
            <div class="status-indicator">
                <span id="status-badge" class="badge badge-stopped">‚óè Stopped</span>
                <span id="uptime-text" class="uptime">Uptime: 0h 0m</span>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav-tabs">
        <button class="tab-button active" onclick="switchTab('overview')">
            <i class="fas fa-chart-bar"></i> Overview
        </button>
        <button class="tab-button" onclick="switchTab('charts')">
            <i class="fas fa-chart-line"></i> Charts
        </button>
        <button class="tab-button" onclick="switchTab('trades')">
            <i class="fas fa-list"></i> Trades
        </button>
        <button class="tab-button" onclick="switchTab('opportunities')">
            <i class="fas fa-dollar-sign"></i> Opportunities
        </button>
        <button class="tab-button" onclick="switchTab('settings')">
            <i class="fas fa-cog"></i> Settings
        </button>
        <button class="tab-button" onclick="switchTab('logs')">
            <i class="fas fa-file-alt"></i> Logs
        </button>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Overview Tab -->
        <div id="tab-overview" class="tab-content active">
            <!-- Key Metrics Cards -->
            <section class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-icon profit">
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="metric-content">
                        <h3>Total P&L</h3>
                        <p id="metric-pnl" class="metric-value">$0.00</p>
                        <span id="metric-pnl-pct" class="metric-change">0%</span>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon success">
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="metric-content">
                        <h3>Win Rate</h3>
                        <p id="metric-winrate" class="metric-value">0%</p>
                        <span class="metric-label">of trades</span>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon info">
                        <i class="fas fa-exchange-alt"></i>
                    </div>
                    <div class="metric-content">
                        <h3>Total Trades</h3>
                        <p id="metric-trades" class="metric-value">0</p>
                        <span class="metric-label">executed</span>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon warning">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="metric-content">
                        <h3>Current Balance</h3>
                        <p id="metric-balance" class="metric-value">$10,000.00</p>
                        <span class="metric-label">paper trading</span>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon danger">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <div class="metric-content">
                        <h3>Active Opportunities</h3>
                        <p id="metric-opportunities" class="metric-value">0</p>
                        <span class="metric-label">currently available</span>
                    </div>
                </div>

                <div class="metric-card">
                    <div class="metric-icon purple">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="metric-content">
                        <h3>Best Strategy</h3>
                        <p id="metric-strategy" class="metric-value">Arbitrage</p>
                        <span class="metric-label">top performer</span>
                    </div>
                </div>
            </section>

            <!-- Strategy Comparison Table -->
            <section class="section-card">
                <h2><i class="fas fa-table"></i> Strategy Performance</h2>
                <div class="table-container">
                    <table id="strategy-table" class="data-table">
                        <thead>
                            <tr>
                                <th onclick="sortTable(0)">Strategy <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(1)">Total Trades <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(2)">Win Rate (%) <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(3)">Total P&L ($) <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(4)">Avg Profit <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(5)">ROI (%) <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(6)">Best Trade <i class="fas fa-sort"></i></th>
                                <th onclick="sortTable(7)">Worst Trade <i class="fas fa-sort"></i></th>
                            </tr>
                        </thead>
                        <tbody id="strategy-tbody">
                            <tr>
                                <td colspan="8" class="no-data">No strategy data available</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Alerts Feed -->
            <section class="section-card alerts-section">
                <h2><i class="fas fa-bell"></i> Recent Alerts</h2>
                <div id="alerts-container" class="alerts-container">
                    <p class="no-data">No alerts</p>
                </div>
            </section>
        </div>

        <!-- Charts Tab -->
        <div id="tab-charts" class="tab-content">
            <section class="section-card">
                <h2><i class="fas fa-chart-area"></i> P&L Over Time</h2>
                <div class="chart-container">
                    <canvas id="pnl-chart"></canvas>
                </div>
            </section>

            <section class="section-card">
                <h2><i class="fas fa-chart-bar"></i> Strategy Performance Comparison</h2>
                <div class="chart-toggle">
                    <button class="btn-toggle active" onclick="toggleChartView('pnl')">P&L View</button>
                    <button class="btn-toggle" onclick="toggleChartView('winrate')">Win Rate View</button>
                </div>
                <div class="chart-container">
                    <canvas id="strategy-chart"></canvas>
                </div>
            </section>
        </div>

        <!-- Trades Tab -->
        <div id="tab-trades" class="tab-content">
            <section class="section-card">
                <h2><i class="fas fa-history"></i> Trade History</h2>
                <div class="table-controls">
                    <input type="text" id="trade-search" placeholder="Search trades..." class="search-input">
                    <button class="btn btn-secondary" onclick="exportTradesCSV()">
                        <i class="fas fa-download"></i> Export CSV
                    </button>
                </div>
                <div class="table-container">
                    <table id="trades-table" class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Market Question</th>
                                <th>Strategy</th>
                                <th>YES Price</th>
                                <th>NO Price</th>
                                <th>Trade Size</th>
                                <th>Profit/Loss ($)</th>
                                <th>Profit/Loss (%)</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="trades-tbody">
                            <tr>
                                <td colspan="9" class="no-data">No trades executed yet</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="pagination" id="trades-pagination">
                    <button class="btn btn-sm" onclick="changeTradePage(-1)">Previous</button>
                    <span id="page-info">Page 1 of 1</span>
                    <button class="btn btn-sm" onclick="changeTradePage(1)">Next</button>
                </div>
            </section>
        </div>

        <!-- Opportunities Tab -->
        <div id="tab-opportunities" class="tab-content">
            <section class="section-card">
                <h2><i class="fas fa-bullseye"></i> Live Opportunities Feed</h2>
                <div id="opportunities-container" class="opportunities-container">
                    <p class="no-data">No opportunities detected</p>
                </div>
            </section>
        </div>

        <!-- Settings Tab -->
        <div id="tab-settings" class="tab-content">
            <section class="section-card">
                <h2><i class="fas fa-bell"></i> Notification Settings</h2>
                <div class="settings-group">
                    <div class="setting-item">
                        <label class="switch">
                            <input type="checkbox" id="toggle-desktop" onchange="toggleNotification('desktop', this.checked)">
                            <span class="slider"></span>
                        </label>
                        <div class="setting-label">
                            <i class="fas fa-desktop"></i>
                            <span>Desktop Notifications</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="switch">
                            <input type="checkbox" id="toggle-email" onchange="toggleNotification('email', this.checked)">
                            <span class="slider"></span>
                        </label>
                        <div class="setting-label">
                            <i class="fas fa-envelope"></i>
                            <span>Email Notifications</span>
                        </div>
                    </div>
                    <div class="setting-item">
                        <label class="switch">
                            <input type="checkbox" id="toggle-telegram" onchange="toggleNotification('telegram', this.checked)">
                            <span class="slider"></span>
                        </label>
                        <div class="setting-label">
                            <i class="fas fa-paper-plane"></i>
                            <span>Telegram Notifications</span>
                        </div>
                    </div>
                </div>
            </section>

            <section class="section-card">
                <h2><i class="fas fa-sliders-h"></i> Trading Configuration</h2>
                <div class="settings-group">
                    <div class="config-item">
                        <label>Minimum Profit Threshold (%)</label>
                        <input type="number" id="config-min-profit" step="0.01" class="config-input">
                    </div>
                    <div class="config-item">
                        <label>Maximum Trade Size ($)</label>
                        <input type="number" id="config-max-trade" step="1" class="config-input">
                    </div>
                    <div class="config-item">
                        <label>Max Trades Per Hour</label>
                        <input type="number" id="config-max-per-hour" step="1" class="config-input">
                    </div>
                </div>
                <div class="settings-actions">
                    <button class="btn btn-success" onclick="saveConfiguration()">
                        <i class="fas fa-save"></i> Save Configuration
                    </button>
                    <button class="btn btn-secondary" onclick="resetConfiguration()">
                        <i class="fas fa-undo"></i> Reset to Defaults
                    </button>
                </div>
            </section>
        </div>

        <!-- Logs Tab -->
        <div id="tab-logs" class="tab-content">
            <section class="section-card">
                <h2><i class="fas fa-info-circle"></i> System Information</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Bot Version:</span>
                        <span class="info-value">1.0.0</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Uptime:</span>
                        <span id="info-uptime" class="info-value">0h 0m</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Last Update:</span>
                        <span id="info-last-update" class="info-value">Never</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Connection Status:</span>
                        <span id="info-connection" class="info-value badge badge-success">Connected</span>
                    </div>
                </div>
            </section>

            <section class="section-card">
                <h2><i class="fas fa-terminal"></i> Recent Activity Log</h2>
                <div id="activity-log" class="log-container">
                    <p class="no-data">No activity logged</p>
                </div>
            </section>
        </div>
    </main>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/controls.js') }}"></script>
</body>
</html>
